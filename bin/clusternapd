#!/usr/bin/env python

import sys, time
import action_on_off
import logset
from daemon import Daemon

log      = logset.get("clusternapd_event", "event.log")
errorlog = logset.get("clusternapd_error", "error.log")
#config_dir = 

class clusternapd(Daemon):
	def run(self):
		log.info("DAEMON clusternapd started")
		while True:
			try:
				action_on_off.action_on_off().main()
				time.sleep(5)
			except Exception as ex:
				msg1 = "An error occured while running clusternapd. Error is: "
				errorlog.error("clusternapd: " + msg1)
				errorlog.error(str(ex))
				

if __name__ == "__main__":
	daemon = clusternapd('/tmp/clusternapd.pid')
	if len(sys.argv) == 2:
		if 'start' == sys.argv[1]:
			daemon.start()
		elif 'stop' == sys.argv[1]:
			daemon.stop()
		elif 'restart' == sys.argv[1]:
			daemon.restart()
		else:
			print "Unknown command"
			sys.exit(2)
		sys.exit(0)
	else:
		print "usage: %s start|stop|restart" % sys.argv[0]
		sys.exit(2)
